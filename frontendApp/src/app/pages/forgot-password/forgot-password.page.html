<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Forgot Password</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="forgot-password-container">
    <!-- Email Not Sent View -->
    <div *ngIf="!emailSent" class="email-form-view">
      <div class="header-section">
        <ion-icon name="mail-unread" class="header-icon"></ion-icon>
        <h1>Reset Your Password</h1>
        <p class="subtitle">
          Enter your email address and we'll send you instructions to reset your password.
        </p>
      </div>

      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="forgot-password-form">
        <!-- Email Field -->
        <ion-item class="input-item" lines="none">
          <ion-input
            fill="outline"
            label="Email Address"
            labelPlacement="floating"
            formControlName="email"
            type="email"
            placeholder="Enter your email"
            autocomplete="email"
            [class.invalid]="forgotPasswordForm.get('email')?.touched && forgotPasswordForm.get('email')?.invalid"
          >
            <ion-icon name="mail-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="getFieldError('email')">
          <ion-icon name="alert-circle-outline"></ion-icon>
          <span>{{ getFieldError('email') }}</span>
        </div>

        <!-- Send Reset Email Button -->
        <ion-button
          expand="block"
          type="submit"
          [disabled]="loading"
          class="submit-btn"
        >
          <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
          <span *ngIf="!loading">Send Reset Email</span>
        </ion-button>

        <!-- Back to Login Link -->
        <div class="back-link">
          <ion-button
            expand="block"
            fill="clear"
            (click)="goToLogin()"
            type="button"
          >
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            Back to Login
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Email Sent Success View -->
    <div *ngIf="emailSent" class="email-sent-view">
      <div class="success-section">
        <ion-icon name="checkmark-circle" class="success-icon"></ion-icon>
        <h1>Check Your Email</h1>
        <p class="success-message">
          We've sent password reset instructions to your email address.
          Please check your inbox and follow the link to reset your password.
        </p>

        <div class="info-card">
          <ion-icon name="information-circle-outline"></ion-icon>
          <div class="info-content">
            <p><strong>Didn't receive the email?</strong></p>
            <ul>
              <li>Check your spam or junk folder</li>
              <li>Make sure you entered the correct email address</li>
              <li>Wait a few minutes for the email to arrive</li>
            </ul>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <ion-button
            expand="block"
            fill="outline"
            (click)="resendEmail()"
            type="button"
            class="resend-btn"
          >
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Resend Email
          </ion-button>

          <ion-button
            expand="block"
            fill="solid"
            (click)="goToLogin()"
            type="button"
            class="login-btn"
          >
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            Back to Login
          </ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-content>
