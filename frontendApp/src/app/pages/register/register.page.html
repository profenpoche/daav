<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Create Account</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="register-container">
    <div class="header-section">
      <ion-icon name="person-add" class="header-icon"></ion-icon>
      <h1>Join Us</h1>
      <p class="subtitle">Create your account to get started</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      <!-- Username Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="Username"
          labelPlacement="floating"
          formControlName="username"
          type="text"
          placeholder="Choose a username"
          autocomplete="username"
          [class.invalid]="registerForm.get('username')?.touched && registerForm.get('username')?.invalid"
        >
          <ion-icon name="at-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('username')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('username') }}</span>
      </div>

      <!-- Email Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="Email"
          labelPlacement="floating"
          formControlName="email"
          type="email"
          placeholder="Enter your email"
          autocomplete="email"
          [class.invalid]="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
        >
          <ion-icon name="mail-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('email')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('email') }}</span>
      </div>

      <!-- First Name Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="First Name"
          labelPlacement="floating"
          formControlName="firstName"
          type="text"
          placeholder="Enter your first name"
          autocomplete="given-name"
          [class.invalid]="registerForm.get('firstName')?.touched && registerForm.get('firstName')?.invalid"
        >
          <ion-icon name="person-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('firstName')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('firstName') }}</span>
      </div>

      <!-- Last Name Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="Last Name"
          labelPlacement="floating"
          formControlName="lastName"
          type="text"
          placeholder="Enter your last name"
          autocomplete="family-name"
          [class.invalid]="registerForm.get('lastName')?.touched && registerForm.get('lastName')?.invalid"
        >
          <ion-icon name="person-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('lastName')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('lastName') }}</span>
      </div>

      <!-- Password Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="Password"
          labelPlacement="floating"
          formControlName="password"
          type="password"
          placeholder="Create a strong password"
          autocomplete="new-password"
          [class.invalid]="registerForm.get('password')?.touched && registerForm.get('password')?.invalid"
        >
          <ion-icon name="lock-closed-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
          <ion-input-password-toggle slot="end"></ion-input-password-toggle>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('password')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('password') }}</span>
      </div>

      <!-- Password Strength Indicator -->
      <div class="password-requirements" *ngIf="registerForm.get('password')?.touched">
        <p class="requirements-title">Password must contain:</p>
        <ul class="requirements-list">
          <li [class.met]="!getPasswordStrengthErrors().includes('one uppercase letter')">
            <ion-icon [name]="!getPasswordStrengthErrors().includes('one uppercase letter') ? 'checkmark-circle' : 'close-circle'"></ion-icon>
            At least one uppercase letter
          </li>
          <li [class.met]="!getPasswordStrengthErrors().includes('one lowercase letter')">
            <ion-icon [name]="!getPasswordStrengthErrors().includes('one lowercase letter') ? 'checkmark-circle' : 'close-circle'"></ion-icon>
            At least one lowercase letter
          </li>
          <li [class.met]="!getPasswordStrengthErrors().includes('one number')">
            <ion-icon [name]="!getPasswordStrengthErrors().includes('one number') ? 'checkmark-circle' : 'close-circle'"></ion-icon>
            At least one number
          </li>
          <li [class.met]="!getPasswordStrengthErrors().includes('one special character')">
            <ion-icon [name]="!getPasswordStrengthErrors().includes('one special character') ? 'checkmark-circle' : 'close-circle'"></ion-icon>
            At least one special character
          </li>
          <li [class.met]="registerForm.get('password')?.value?.length >= 8">
            <ion-icon [name]="registerForm.get('password')?.value?.length >= 8 ? 'checkmark-circle' : 'close-circle'"></ion-icon>
            At least 8 characters long
          </li>
        </ul>
      </div>

      <!-- Confirm Password Field -->
      <ion-item class="input-item" lines="none">
        <ion-input
          fill="outline"
          label="Confirm Password"
          labelPlacement="floating"
          formControlName="confirmPassword"
          type="password"
          placeholder="Re-enter your password"
          autocomplete="new-password"
          [class.invalid]="registerForm.get('confirmPassword')?.touched && (registerForm.get('confirmPassword')?.invalid || registerForm.errors?.['passwordMismatch'])"
        >
          <ion-icon name="lock-closed-outline" slot="start" class="input-icon" aria-hidden="true"></ion-icon>
          <ion-input-password-toggle slot="end"></ion-input-password-toggle>
        </ion-input>
      </ion-item>
      <div class="error-message" *ngIf="getFieldError('confirmPassword')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>{{ getFieldError('confirmPassword') }}</span>
      </div>

      <!-- Register Button -->
      <ion-button
        expand="block"
        type="submit"
        [disabled]="loading"
        class="register-btn"
      >
        <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
        <span *ngIf="!loading">Create Account</span>
      </ion-button>

      <!-- Login Link -->
      <div class="login-section">
        <p>Already have an account?</p>
        <ion-button
          expand="block"
          fill="outline"
          (click)="goToLogin()"
          type="button"
          class="login-link-btn"
        >
          Sign In
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>
